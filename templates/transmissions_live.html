<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Transmissions - Dark Forest Interactive</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-container">
                <div class="logo-container">
                    <img src="{{ url_for('static', filename='images/Logo RemoveBG.png') }}" alt="Dark Forest Interactive Logo" class="logo">
                </div>
                <h1>DARK FOREST INTERACTIVE</h1>
            </div>
            <div class="social-links">
                <a href="{{ config['STARWEAVER_TWITTER_URL'] }}" class="social-link" target="_blank" rel="noopener noreferrer">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="https://github.com/DarkForestAIDev" class="social-link" target="_blank" rel="noopener noreferrer">
                    <i class="fab fa-github"></i>
                </a>
            </div>
            <nav class="main-nav">
                <a href="/">CHAPTER ONE</a>
                <a href="/chapter-two">CHAPTER TWO</a>
                <a href="/transmissions" class="active">LIVE TRANSMISSIONS</a>
                <a href="/about">ABOUT</a>
            </nav>
        </header>

        {% if transmissions %}
        <!-- Signal Initialization Display -->
        <div class="transmission-status">
            <div class="init-sequence">
                > INITIALIZING QUANTUM ARRAY
                > ALIGNING SUBSPACE ANTENNA
                > AWAITING SIGNAL LOCK
                <span class="blink">>_</span>
            </div>
            <div class="status">STANDBY FOR INCOMING TRANSMISSIONS</div>
        </div>

        <!-- Most Recent Transmission -->
        <div class="latest-transmission">
            <h2>NEWEST TRANSMISSION</h2>
            <div class="transmission latest">
                <div class="transmission-header">
                    <span class="status latest">{{ transmissions[0].status }}</span>
                    <div class="signal-strength">
                        <span class="signal-label">SIGNAL</span>
                        <div class="signal-bar" style="--strength: {{ transmissions[0].signal_strength }}%"></div>
                        <span class="signal-value">{{ transmissions[0].signal_strength }}%</span>
                    </div>
                    <button class="play-audio" onclick="playTransmission('{{ transmissions[0].id }}')">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
                <div class="message">{{ transmissions[0].message }}</div>
                <div class="timestamp">{{ transmissions[0].timestamp }}</div>
                <audio id="audio-{{ transmissions[0].id }}" style="display: none;">
                    <source src="{{ url_for('get_transmission_audio', transmission_id=transmissions[0].id) }}" type="audio/mpeg">
                </audio>
            </div>
        </div>

        <!-- Archive Separator -->
        <div class="archive-separator">
            <h3>TRANSMISSION ARCHIVE</h3>
            <div class="separator-line"></div>
        </div>

        <!-- Past Transmissions -->
        <div class="transmission-feed">
            {% for transmission in transmissions[1:] %}
            <div class="transmission">
                <div class="transmission-header">
                    <span class="status">{{ transmission.status }}</span>
                    <div class="signal-strength">
                        <span class="signal-label">SIGNAL</span>
                        <div class="signal-bar" style="--strength: {{ transmission.signal_strength }}%"></div>
                        <span class="signal-value">{{ transmission.signal_strength }}%</span>
                    </div>
                    <button class="play-audio" onclick="playTransmission('{{ transmission.id }}')">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
                <div class="message">{{ transmission.message }}</div>
                <div class="timestamp">{{ transmission.timestamp }}</div>
                <audio id="audio-{{ transmission.id }}" style="display: none;">
                    <source src="{{ url_for('get_transmission_audio', transmission_id=transmission.id) }}" type="audio/mpeg">
                </audio>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <style>
        .transmission-status {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #2a6478;
            padding: 20px;
            font-family: 'Courier New', monospace;
            color: #00ff9d;
            margin: 20px 0;
            box-shadow: 0 0 10px rgba(0, 255, 157, 0.2);
        }

        .init-sequence {
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .blink {
            animation: blink 1s infinite;
        }

        .status {
            color: #ff9d00;
            text-align: center;
            margin-top: 20px;
            letter-spacing: 2px;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        </style>

        <!-- Remove the countdown JavaScript and replace with this -->
        <script>
            // Audio state tracking
            let currentlyPlaying = null;

            // Function to play transmission audio
            function playTransmission(transmissionId) {
                const audio = document.getElementById(`audio-${transmissionId}`);
                const button = document.querySelector(`button[onclick="playTransmission('${transmissionId}')"]`);
                
                // Stop any currently playing audio
                if (currentlyPlaying && currentlyPlaying !== audio) {
                    currentlyPlaying.pause();
                    currentlyPlaying.currentTime = 0;
                    const oldButton = document.querySelector(`button[onclick="playTransmission('${currentlyPlaying.id.replace('audio-', '')}')"]`);
                    if (oldButton) {
                        oldButton.innerHTML = '<i class="fas fa-play"></i>';
                    }
                }
                
                if (audio.paused) {
                    audio.play()
                        .then(() => {
                            button.innerHTML = '<i class="fas fa-pause"></i>';
                            currentlyPlaying = audio;
                        })
                        .catch(error => {
                            console.error('Error playing audio:', error);
                            button.innerHTML = '<i class="fas fa-play"></i>';
                        });
                } else {
                    audio.pause();
                    button.innerHTML = '<i class="fas fa-play"></i>';
                }
                
                // Reset button when audio ends
                audio.onended = () => {
                    button.innerHTML = '<i class="fas fa-play"></i>';
                    currentlyPlaying = null;
                };
            }
        </script>
    </div>
</body>
</html> 